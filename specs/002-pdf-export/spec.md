# Feature Specification: PDF Export with Selective Filters

**Feature ID**: 002-pdf-export
**Status**: Draft
**Created**: 2025-11-04
**Author**: Claude Code (Spec-Kit)
**Priority**: High

## Executive Summary

Add professional PDF export functionality to Land Visualizer that allows users to generate comprehensive property reports with selective data filtering. Users can choose which shape properties to include, customize the report format, and export their land visualizations as professional PDF documents suitable for presentations, documentation, or client deliverables.

## Problem Statement

Currently, users can create detailed land visualizations with shapes, measurements, and comparisons, but have no way to:
- Share their work in a portable, professional format
- Document property analyses for records or presentations
- Generate reports for clients or stakeholders
- Archive project snapshots for future reference

Users need a way to export their work as PDF documents with control over what data is included, ensuring reports are clean, professional, and tailored to their specific needs.

## User Stories

### Primary Users: Property Surveyors, Real Estate Agents, Land Developers

**US-001**: As a property surveyor, I want to export my land measurements to PDF so that I can provide professional documentation to clients.

**US-002**: As a real estate agent, I want to customize which shape properties appear in the export so that I can create clean, client-facing reports without technical details.

**US-003**: As a land developer, I want to export visualizations with area calculations so that I can analyze and compare multiple property options.

**US-004**: As a project manager, I want to generate PDF reports with shape dimensions and positions so that I can document baseline measurements for future reference.

**US-005**: As a user, I want to access the export feature from the toolbar so that I can quickly generate reports without disrupting my workflow.

## Functional Requirements

### FR-001: Export Dialog Modal
**Priority**: Critical
**Description**: Canva-inspired modal dialog for configuring PDF export options

**Requirements**:
- Modal opens when user clicks "Export" button in ribbon toolbar
- Clean, professional design matching Land Visualizer's Canva-inspired aesthetic
- Real-time preview of selected filters
- Export/Cancel buttons with keyboard shortcuts (Enter/Esc)
- Loading state during PDF generation
- Success/error feedback with toast notifications

**AMBIGUITY**: Should the modal show a thumbnail preview of the PDF output?

### FR-002: Selective Data Filtering
**Priority**: Critical
**Description**: Allow users to choose which shape properties to include in the export

**Filter Categories**:
1. **Basic Information** (default: enabled)
   - Shape type (rectangle, circle, polyline, etc.)
   - Shape ID/name
   - Creation timestamp

2. **Dimensions** (default: enabled)
   - Width/Height for rectangles
   - Radius/Diameter for circles
   - Perimeter for polylines
   - Area calculations
   - Unit of measurement

3. **Position & Orientation** (default: disabled)
   - X, Y, Z coordinates
   - Rotation angle
   - Scale factors

4. **Visual Properties** (default: disabled)
   - Fill color
   - Stroke color
   - Opacity
   - Layer assignment

5. **Metadata** (default: disabled)
   - Created date
   - Modified date
   - User notes (if added in future)

**UI Implementation**:
- Checkbox list with category headers
- "Select All" / "Deselect All" quick actions
- Collapsible sections for organization
- Live count of properties to be exported

### FR-003: PDF Document Generation
**Priority**: Critical
**Description**: Generate professional PDF documents with exported data

**PDF Structure**:
1. **Header Section**
   - Document title: "Land Visualizer Export Report"
   - Export date and time
   - Project name (if set, else "Untitled Project")
   - Land Visualizer logo and branding

2. **Summary Section**
   - Total number of shapes
   - Total area (sum of all shape areas)
   - Unit system used
   - Shape type breakdown (e.g., "3 rectangles, 2 circles, 1 polyline")

3. **Shape Details Section**
   - Table format with rows per shape
   - Columns based on selected filters
   - Professional formatting with headers, borders, alternating row colors
   - Auto-width columns for readability

4. **Footer Section**
   - Page numbers
   - "Generated by Land Visualizer" watermark
   - Export timestamp

**PDF Specifications**:
- Paper size: Letter (8.5" x 11") / A4 (user preference in future)
- Orientation: Portrait (default) / Landscape if many columns
- Font: Nunito Sans (matching Land Visualizer typography)
- Colors: Brand colors (teal #00C4CC accents)
- File size optimization: < 1MB for typical projects

### FR-004: Ribbon Toolbar Integration
**Priority**: High
**Description**: Add Export button to main ribbon toolbar

**Button Specifications**:
- Icon: Download/Export SVG icon (consistent with design system)
- Label: "Export"
- Position: Right side of toolbar, before Help button
- Tooltip: "Export to PDF (Ctrl+E)"
- Disabled state: Grayed out when no shapes exist
- Hover/active states: Standard button transitions (200ms)

**Keyboard Shortcut**:
- Shortcut: Ctrl+E (Cmd+E on Mac)
- Updates keyboard shortcuts help dialog (? key)

### FR-005: File Download Handling
**Priority**: High
**Description**: Generate and trigger browser download of PDF file

**Filename Convention**:
- Format: `land-viz-export-YYYY-MM-DD-HHmmss.pdf`
- Example: `land-viz-export-2025-11-04-143022.pdf`
- Sanitized project name option (future): `{project-name}-export-{date}.pdf`

**Browser Behavior**:
- Trigger native browser download dialog
- No page reload or navigation
- Success toast: "PDF exported successfully!"
- Error handling: "Export failed. Please try again."

## Non-Functional Requirements

### NFR-001: Performance
- PDF generation completes in < 3 seconds for projects with up to 100 shapes
- No UI blocking during generation (use async/background processing)
- Progress indicator for large exports (>50 shapes)

### NFR-002: Browser Compatibility
- Works in Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- Client-side PDF generation (no server required)
- File size: < 1MB for typical projects (20-30 shapes)

### NFR-003: Accessibility
- Export modal fully keyboard navigable (Tab/Shift+Tab)
- ARIA labels on all interactive elements
- Screen reader announcements for export status
- Focus trap within modal dialog
- High contrast mode support

### NFR-004: Security
- No sensitive data in PDF metadata
- No external API calls (client-side only)
- Sanitize user input for project names
- No embedded scripts in PDF

### NFR-005: Design Consistency
- Canva-inspired modal design
- Brand colors (teal, purple, pink accents)
- Nunito Sans typography
- 200ms transitions, 8-12px border radius
- S-Tier SaaS quality (matches Figma, Linear standards)

## Out of Scope (Future Phases)

- **Import from PDF**: Reverse engineering PDF back to shapes
- **Excel/CSV export**: Alternative export formats
- **Custom templates**: User-defined PDF layouts
- **Charts/visualizations**: Embedded charts in PDF
- **Multi-page reports**: Split across multiple pages (current: single page table)
- **Image export**: PNG/JPG of 3D scene (separate feature)
- **Cloud storage**: Direct upload to Google Drive, Dropbox
- **Email integration**: Send PDF via email from app

## Acceptance Criteria

### AC-001: Export Button Visibility
- ✅ Export button appears in ribbon toolbar
- ✅ Button is disabled when no shapes exist
- ✅ Button is enabled when at least one shape exists
- ✅ Tooltip shows "Export to PDF (Ctrl+E)"

### AC-002: Export Dialog Functionality
- ✅ Modal opens when Export button is clicked
- ✅ Modal shows all filter categories with checkboxes
- ✅ Default filters are pre-selected (Basic Info, Dimensions)
- ✅ "Select All" / "Deselect All" buttons work correctly
- ✅ Modal closes on Cancel or Esc key
- ✅ Modal shows loading state during PDF generation

### AC-003: PDF Content Accuracy
- ✅ PDF contains all shapes in the scene
- ✅ PDF includes only selected properties
- ✅ Shape data matches current state in app
- ✅ Area calculations are accurate
- ✅ Units are displayed correctly
- ✅ Summary section shows correct totals

### AC-004: PDF Formatting Quality
- ✅ Professional appearance (matches S-Tier SaaS standards)
- ✅ Brand colors and typography applied
- ✅ Table is readable with proper spacing
- ✅ Headers are bold and distinct
- ✅ Alternating row colors for readability
- ✅ Page numbers and footer present

### AC-005: Performance & Reliability
- ✅ Export completes in < 3 seconds for 20 shapes
- ✅ No browser freezing or lag during generation
- ✅ Success toast appears after download
- ✅ Error toast appears if export fails
- ✅ File downloads with correct filename

### AC-006: Accessibility
- ✅ Modal is keyboard navigable
- ✅ Focus trap works correctly
- ✅ Screen reader announces export status
- ✅ All controls have ARIA labels
- ✅ High contrast mode supported

## Edge Cases & Error Handling

### Edge Case 1: No Shapes to Export
- **Scenario**: User clicks Export when canvas is empty
- **Expected**: Button is disabled (grayed out)
- **Fallback**: If somehow triggered, show toast "No shapes to export"

### Edge Case 2: Very Large Projects (100+ shapes)
- **Scenario**: User exports project with 200 shapes
- **Expected**: Show progress indicator, may take 5-10 seconds
- **Fallback**: Warn user if >100 shapes, suggest filtering shape types

### Edge Case 3: Browser Blocks Download
- **Scenario**: Browser blocks pop-up/download
- **Expected**: Show error toast with instructions
- **Message**: "Download blocked. Please allow downloads and try again."

### Edge Case 4: PDF Generation Fails
- **Scenario**: PDF library throws error during generation
- **Expected**: Show error toast, log error to console (dev mode only)
- **Fallback**: Retry once automatically, then show user-facing error

### Edge Case 5: All Filters Deselected
- **Scenario**: User deselects all filter checkboxes
- **Expected**: Disable Export button in modal, show warning
- **Message**: "Please select at least one property to export"

### Edge Case 6: Special Characters in Project Name
- **Scenario**: Project name contains `/`, `\`, or other invalid filename chars
- **Expected**: Sanitize filename, replace invalid chars with `-`
- **Example**: `My/Project\Name` → `My-Project-Name-export-2025-11-04.pdf`

## Dependencies

### Internal Dependencies
- **Zustand Store**: `useDrawingStore` for shape data
- **Design System**: Button component, Modal component
- **Typography**: Nunito Sans font family
- **Icons**: Download/Export SVG icon

### External Dependencies
- **pdf-lib**: Client-side PDF generation library
  - Version: ^1.17.1
  - License: MIT
  - Bundle size: ~140KB gzipped
  - Alternatives considered: jsPDF (less capable), pdfmake (larger bundle)

- **file-saver**: Trigger file download in browser
  - Version: ^2.0.5
  - License: MIT
  - Bundle size: ~1KB gzipped

### Browser APIs
- **Blob API**: Create PDF blob for download
- **URL.createObjectURL**: Generate download URL
- **File Download API**: Trigger native download

## Success Metrics

### Usage Metrics
- **Adoption Rate**: % of users who export PDFs (target: 40% within 30 days)
- **Export Frequency**: Average exports per user per session (target: 1.5)
- **Filter Usage**: Most commonly selected filters (inform future defaults)

### Performance Metrics
- **Generation Time**: P95 < 3 seconds for 50 shapes
- **File Size**: P95 < 500KB for typical projects
- **Error Rate**: < 1% of export attempts fail

### Quality Metrics
- **User Satisfaction**: CSAT score > 4.5/5 for export feature
- **Bug Reports**: < 5 bugs reported in first 30 days
- **Accessibility**: 100% WCAG 2.1 AA compliance

## Timeline & Phases

### Phase 1: Core Export (Week 1)
- Export button in toolbar
- Basic export dialog (no filters yet)
- Simple PDF generation (all properties)
- File download functionality

### Phase 2: Selective Filtering (Week 2)
- Filter checkboxes in modal
- Category grouping
- Select All/Deselect All
- Live property count

### Phase 3: Polish & Optimization (Week 3)
- Professional PDF formatting
- Brand styling
- Performance optimization
- Error handling

### Phase 4: Testing & Launch (Week 4)
- Comprehensive testing
- Accessibility audit
- Performance benchmarking
- Documentation & release

## Open Questions

1. **PDF Preview**: Should we show a thumbnail preview of the PDF before download?
   - **Impact**: Adds complexity but improves user confidence
   - **Decision needed by**: End of Phase 1

2. **Multi-Page Support**: If table is very long, should we split across pages?
   - **Impact**: Better for large projects (50+ shapes)
   - **Decision needed by**: End of Phase 2

3. **Default Filters**: Should we persist user's filter preferences between exports?
   - **Impact**: Better UX for repeat exports
   - **Decision needed by**: End of Phase 2

4. **Logo Embedding**: Should we embed Land Visualizer logo in PDF header?
   - **Impact**: Branding vs. file size trade-off
   - **Decision needed by**: End of Phase 3

## References

- **Design System**: `docs/design-tokens.md`
- **Testing Standards**: `docs/testing-requirements.md`
- **Accessibility Guidelines**: WCAG 2.1 AA
- **PDF Library Docs**: https://pdf-lib.js.org/docs/api/
- **Similar Features**: Canva export, Figma export, SmartDraw export

---

**Document Version**: 1.0
**Last Updated**: 2025-11-04
**Next Review**: After implementation completion
